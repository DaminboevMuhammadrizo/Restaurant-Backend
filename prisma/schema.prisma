generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

enum UserRole {
    SUPERADMIN
    MANAGER
    AFITSANT
    CHEF
    KASSA
    SUPER_AFITSANT
}

enum OrderStatus {
    PENDING
    SUCCESS
    CANCELED
}

enum Status {
    ACTIVE
    INACTIVE
}

enum UnitType {
    DONA
    KG
    GRAM
    LITR
    ML
    PORSIYA
    QUTI
    BLOK
    PACHKA
    TOVA
}

model Company {
    id          String  @id @default(uuid())
    name        String
    phone       String  @unique
    founderName String
    logo        String?
    bio         String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    branch Branch[]
    user   User[]
}

model Branch {
    id        String  @id @default(uuid())
    name      String  @unique
    addres    String?
    companyId String
    kpi       Float?
    status    Status  @default(ACTIVE)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

    user            User[]
    room            Room[]
    order           Order[]
    product         Product[]
    orderItem       OrderItem[]
    roomCategory    RoomCategory[]
    productCategory ProductCategory[]
    popularProducts PopularProducts[]
}

model User {
    id         String   @id @default(uuid())
    firstName  String
    lastName   String
    phoneNumer String   @unique
    password   String
    companyId  String?
    branchId   String?
    status     Status   @default(ACTIVE)
    role       UserRole

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    company Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
    branch  Branch?  @relation(fields: [branchId], references: [id], onDelete: Cascade)

    order Order[]
}

model RoomCategory {
    id       String @id @default(uuid())
    name     String
    branchId String
    status   Status @default(ACTIVE)

    room   Room[]
    branch Branch @relation(fields: [branchId], references: [id])
}

model Room {
    id             String @id @default(uuid())
    name           String
    price          Float
    branchId       String
    roomCategoryId String
    status         Status @default(ACTIVE)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

    order        Order[]
    roomCategory RoomCategory @relation(fields: [roomCategoryId], references: [id])
}

model ProductCategory {
    id       String  @id @default(uuid())
    name     String
    branchId String
    icon     String?
    status   Status  @default(ACTIVE)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

    product Product[]
}

model Product {
    id                String   @id @default(uuid())
    name              String
    desc              String?
    price             Float
    photo             String?
    amount            Int
    branchId          String
    productCategoryId String
    unit              UnitType
    status            Status   @default(ACTIVE)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    productCategory ProductCategory @relation(fields: [productCategoryId], references: [id], onDelete: Cascade)
    branch          Branch          @relation(fields: [branchId], references: [id], onDelete: Cascade)

    orderItem       OrderItem[]
    popularProducts PopularProducts[]
}

model PopularProducts {
    id        String   @id @default(uuid())
    product   Product? @relation(fields: [productId], references: [id])
    productId String?
    branch    Branch?  @relation(fields: [branchId], references: [id])
    branchId  String?
}

model Order {
    id        String      @id @default(uuid())
    userId    String
    roomId    String
    endAt     DateTime
    branchId  String
    status    OrderStatus
    createdAt DateTime    @default(now())

    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
    room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)
    branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

    orderItem OrderItem[]
}

model OrderItem {
    id        String @id @default(uuid())
    orderId   String
    productId String
    branchId  String
    count     Int

    createdAt DateTime @default(now())

    order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
    branch  Branch  @relation(fields: [branchId], references: [id], onDelete: Cascade)
}
